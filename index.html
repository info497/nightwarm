<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NightWarm｜セルフチェック</title>

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1b2c48">

    <link rel="stylesheet" href="styles.css" />

    <style>
        body {
            background: radial-gradient(circle at top, #1b2c48, #0a0f1a 60%);
            color: #e7ecf5;
            font-family: "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 480px;
            padding: 20px;
            text-align: center;
        }

        .logo {
            width: 140px;
            margin: 30px auto 20px;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #c7d7ff;
            margin-bottom: 15px;
        }

        .start-btn {
            margin-top: 30px;
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #4f7cff, #273e7a);
            color: white;
            padding: 14px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .start-btn:hover {
            opacity: 0.9;
        }

        #q-box {
            display: none;
            margin-top: 20px;
        }

        .q-title {
            font-size: 1.3rem;
            color: #cdd9ff;
            margin-bottom: 20px;
        }

        .option-btn {
            width: 100%;
            background: rgba(255,255,255,0.07);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 14px;
            font-size: 1.05rem;
            text-align: left;
            margin-bottom: 14px;
            color: #e7ecf5;
        }

        .option-btn:hover {
            background: rgba(255,255,255,0.13);
        }
    </style>
</head>

<body>
    <div class="container">

        <!-- ロゴ -->
        <img src="icons/icon-192.png" class="logo" alt="NightWarm ロゴ">

        <h1>NightWarm 足の冷えチェック</h1>

        <a id="startButton" class="start-btn">診断を開始する</a>

        <div id="q-box">
            <p id="q-title" class="q-title">読み込み中...</p>
            <div id="options"></div>
        </div>
    </div>

    <script>
        let questions = [];
        let index = 0;
        let score = 0;

        // 質問データを読み込み
        async function loadQuestions() {
            try {
                console.log("FETCH START");
                const response = await fetch("questions/behavior.json");

                if (!response.ok) throw new Error("HTTP " + response.status);
                console.log("FETCH OK");

                questions = await response.json();
                showQuestion();
            } catch (e) {
                console.error(e);
                document.getElementById("q-title").innerText =
                    "質問データ（behavior.json）が読み込めません。";
            }
        }

        // 開始ボタン押下
        document.getElementById("startButton").addEventListener("click", () => {
            document.getElementById("startButton").style.display = "none";
            document.getElementById("q-box").style.display = "block";
            loadQuestions();
        });

        // 質問表示
        function showQuestion() {
            const q = questions[index];
            document.getElementById("q-title").innerText = q.question;

            const optBox = document.getElementById("options");
            optBox.innerHTML = "";

            q.options.forEach(opt => {
                const btn = document.createElement("button");
                btn.className = "option-btn";
                btn.innerText = opt.text;
                btn.onclick = () => {
                    score += opt.value;
                    nextQuestion();
                };
                optBox.appendChild(btn);
            });
        }

        // 次へ
        function nextQuestion() {
            index++;
            if (index >= questions.length) {
                finish();
            } else {
                showQuestion();
            }
        }

        // 結果ページへ
        function finish() {
            localStorage.setItem("nightwarmScore", score);
            window.location.href = "result.html";
        }
    </script>

</body>
</html>
