<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>NightWarm</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- アイコン（念のため）-->
  <link rel="icon" href="/icons/icon-192.png" type="image/png">

  <!-- 基本UIスタイル -->
  <style>
    body {
      font-family: "Arial", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6fb;
      color: #333;
    }

    header {
      background: linear-gradient(135deg, #0033cc, #0055ff);
      color: #fff;
      padding: 16px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: bold;
    }

    .container {
      max-width: 680px;
      margin: 0 auto;
      padding: 20px;
    }

    .card {
      background: #fff;
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.15);
      margin-bottom: 20px;
    }

    .button {
      display: block;
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      background: #0033cc;
      color: #fff;
      text-align: center;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      text-decoration: none;
    }
  </style>
</head>

<body>
  <header>NightWarm（仮）</header>

  <div class="container">

    <!-- TOP カード -->
    <div class="card">
      <h2>睡眠中の「足の冷え」「夜間頻尿」を改善するアプリ</h2>
      <p>このアプリは、あなたの状態に合わせて最適な改善ガイドを提案します。</p>
    </div>

    <!-- 質問フロー開始ボタン -->
    <div class="card">
      <h3>足の冷えチェックを始める</h3>
      <a class="button" id="startQuestions">スタート</a>
    </div>

    <!-- 質問表示エリア（後で中身が JS で表示される）-->
    <div id="questionArea"></div>

    <!-- 結果表示エリア -->
    <div id="resultArea"></div>

  </div>

  <!-- JavaScript（質問ロジック）-->
  <script>
    let questions = [];
    let currentIndex = 0;
    let answers = {};

    // ▼▼ 外部 JSON を読み込む（/questions/behavior.json） ▼▼
    function loadQuestions() {
      fetch("/questions/behavior.json")
        .then(res => res.json())
        .then(data => {
          questions = data.behavior_questions;
          showQuestion();
        })
        .catch(err => {
          alert("質問データの読み込みに失敗しました。ファイルの場所を確認してください。");
        });
    }

    // ▼▼ 質問を表示 ▼▼
    function showQuestion() {
      const area = document.getElementById("questionArea");
      const q = questions[currentIndex];

      area.innerHTML = `
        <div class="card">
          <h3>質問 ${currentIndex + 1}/${questions.length}</h3>
          <p>${q.question}</p>
          ${q.type === "choice" ? renderChoices(q.options) : ""}
        </div>
      `;
    }

    // 選択肢UIを生成
    function renderChoices(options) {
      return options.map(opt => `
        <div class="button" onclick="selectAnswer('${opt.value}')">${opt.label}</div>
      `).join("");
    }

    // ▼▼ 回答処理 ▼▼
    function selectAnswer(value) {
      const q = questions[currentIndex];
      answers[q.id] = value;
      currentIndex++;

      if (currentIndex >= questions.length) {
        showResult();
      } else {
        showQuestion();
      }
    }

    // ▼▼ 結果表示（簡易版：調整可能） ▼▼
    function showResult() {
      document.getElementById("questionArea").innerHTML = "";
      document.getElementById("resultArea").innerHTML = `
        <div class="card">
          <h2>診断結果（仮）</h2>
          <p>回答数：${Object.keys(answers).length} / ${questions.length}</p>
          <p>本格的な診断ロジックはこの後追加できます。</p>
        </div>
      `;
    }

    // ▼▼ スタートボタン ▼▼
    document.getElementById("startQuestions").addEventListener("click", loadQuestions);
  </script>

  <!-- PWA Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js").catch((err) => {
        console.log("SW登録失敗:", err);
      });
    }
  </script>

</body>
</html>
