<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container">
    <h1>è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ</h1>

    <p id="score-text">è¨ˆç®—ä¸­...</p>
    <div id="report-container">çµæœã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

    <button onclick="window.location.href='index.html'" class="restart-btn">
      ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹
    </button>
  </div>

  <script>
    async function loadReport() {
      // ğŸ“Œ index.html ã‹ã‚‰ scores ã‚’å–å¾—
      const params = new URLSearchParams(window.location.search);
      const scores = JSON.parse(params.get("scores") || "[]");

      const total = scores.reduce((a, b) => a + b, 0);

      document.getElementById("score-text").innerText =
        `ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ï¼š${total}ç‚¹ï¼ˆ0ã€œ36ç‚¹ï¼‰`;

      // ğŸ“Œ ãƒ¬ãƒãƒ¼ãƒˆ JSON èª­ã¿è¾¼ã¿
      let reportData = {};
      try {
        const response = await fetch("/questions/report.json");
        if (!response.ok) throw new Error("report.json ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
        reportData = await response.json();
      } catch (e) {
        document.getElementById("report-container").innerText =
          "ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚";
        return;
      }

      // ğŸ“Œ ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦åˆ†é¡
      let report = "";
      if (total <= 12) {
        report = reportData.low;
      } else if (total <= 24) {
        report = reportData.mid;
      } else {
        report = reportData.high;
      }

      // ğŸ“Œ HTMLã«åæ˜ 
      document.getElementById("report-container").innerHTML = `
        <h2>${report.title}</h2>
        <p>${report.desc}</p>

        <h3>ãŠã™ã™ã‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
        <ul>
          ${report.actions.map(a => `<li>${a}</li>`).join("")}
        </ul>

        <h3>è§£èª¬</h3>
        <p>${report.detail}</p>
      `;
    }

    loadReport();
  </script>
</body>
</html>
